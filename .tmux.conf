# -----------------------------------------------------------------------------
# 1. Terminal & Color Settings
# -----------------------------------------------------------------------------
# Support 256 colors and True Color (essential for LazyVim themes)
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Fix escape-time delay (essential for Neovim responsiveness)
set -sg escape-time 10

# -----------------------------------------------------------------------------
# 2. General Settings
# -----------------------------------------------------------------------------
# Set prefix to Ctrl-a (easier to reach)
set -g prefix C-a
unbind C-b
bind C-a send-prefix

# Start windows and panes at index 1
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# Enable mouse mode
set -g mouse on

# Use system clipboard
set -g set-clipboard on

# Use Vi mode for copy-mode
setw -g mode-keys vi

# -----------------------------------------------------------------------------
# 3. Keybindings
# -----------------------------------------------------------------------------
# Reload config file quickly
bind r source-file ~/.tmux.conf \; display "Config Reloaded!"

# Split panes using | and - (opens in current path)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# -----------------------------------------------------------------------------
# 4. Seamless Neovim/Tmux Navigation (Ctrl+h,j,k,l)
# -----------------------------------------------------------------------------
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\S+\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

# -----------------------------------------------------------------------------
# 5. Advanced Copy Mode & Mouse Selection (VSCode Style)
# -----------------------------------------------------------------------------
# 'v' starts selection, 'y' yanks to Mac clipboard
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "sh -c 'pbcopy 2>/dev/null || xclip -selection clipboard'"

# Mouse: Clicking & Dragging automatically copies to clipboard
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "sh -c 'pbcopy 2>/dev/null || xclip -selection clipboard'"

# Double click to select word and copy
bind-key -T copy-mode-vi DoubleClick1Pane select-pane \; send-keys -X select-word \; send-keys -X copy-pipe-and-cancel "sh -c 'pbcopy 2>/dev/null || xclip -selection clipboard'"

# Triple click to select line and copy
bind-key -T copy-mode-vi TripleClick1Pane select-pane \; send-keys -X select-line \; send-keys -X copy-pipe-and-cancel "sh -c 'pbcopy 2>/dev/null || xclip -selection clipboard'"

# Update Enter to use clipboard as well
unbind -T copy-mode-vi Enter
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "sh -c 'pbcopy 2>/dev/null || xclip -selection clipboard'"

# -----------------------------------------------------------------------------
# 6. Plugins (TPM)
# -----------------------------------------------------------------------------
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'niilohlin/tmux-vim-visual'

# Initialize TPM (must be the very last line)
run '~/.tmux/plugins/tpm/tpm'

